<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        #game {
            border: 1px solid black;
            display: block;
            /* margin: 0 auto; */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .images {
            display: none;
        }
    </style>
    <title>Tavlla</title>
</head>

<body>
    <canvas id="game" width="800" height="700"></canvas>
    <img class="images" id="board" src="res/img/board.png">
    <img class="images" id="whitePiece" src="res/img/white-piece.png">
    <img class="images" id="blackPiece" src="res/img/black-piece.png">

    <script>
        window.addEventListener("load", function () {
            const canvas = document.getElementById("game");
            const ctx = canvas.getContext("2d");

            const boardImg = document.getElementById("board");
            const whitePiece = document.getElementById("whitePiece");
            const blackPiece = document.getElementById("blackPiece");
            const pieceSize = 50;
            ctx.drawImage(boardImg, 0, 0, canvas.width, canvas.height);

            class Board {
                constructor() {
                    this.w = canvas.width;
                    this.h = canvas.height;
                    this.positions = [];
                    this.createPositions();
                }

                createPositions() {
                    for (let y = 50; y < canvas.height - 50; y += 350) {
                        for (let x = 50; x < canvas.width - 50; x += 50) {
                            if (x === 350) x += 100;
                            this.positions.push(new Position(this, x, y));
                        }
                    }
                    this.positions.reverse();
                    this.positions = this.positions.splice(0, 12).concat(this.positions.reverse());
                }

                addPieceToPosition(position, player)  {
                    this.positions[position].addPiece(player);
                }

                setBoard() {
                    this.addPieceToPosition(0, "player1");
                    this.addPieceToPosition(0, "player1");
                    this.addPieceToPosition(5, "player2");
                    this.addPieceToPosition(5, "player2");
                    this.addPieceToPosition(5, "player2");
                    this.addPieceToPosition(5, "player2");
                    this.addPieceToPosition(5, "player2");
                    this.addPieceToPosition(7, "player2");
                    this.addPieceToPosition(7, "player2");
                    this.addPieceToPosition(7, "player2");
                    this.addPieceToPosition(11, "player1");
                    this.addPieceToPosition(11, "player1");
                    this.addPieceToPosition(11, "player1");
                    this.addPieceToPosition(11, "player1");
                    this.addPieceToPosition(11, "player1");
                    this.addPieceToPosition(12, "player2");
                    this.addPieceToPosition(12, "player2");
                    this.addPieceToPosition(12, "player2");
                    this.addPieceToPosition(12, "player2");
                    this.addPieceToPosition(12, "player2");
                    this.addPieceToPosition(16, "player1");
                    this.addPieceToPosition(16, "player1");
                    this.addPieceToPosition(16, "player1");
                    this.addPieceToPosition(18, "player1");
                    this.addPieceToPosition(18, "player1");
                    this.addPieceToPosition(18, "player1");
                    this.addPieceToPosition(18, "player1");
                    this.addPieceToPosition(18, "player1");
                    this.addPieceToPosition(23, "player2");
                    this.addPieceToPosition(23, "player2");
                }

                draw(context) {
                    this.positions.forEach(position => position.draw(context));
                }
            }

            class Position {
                constructor(board, x, y, pos) {
                    this.board = board;
                    this.x = x;
                    this.y = y;
                    this.w = 50;
                    this.h = 250;
                    this.tiles = [];
                    this.createTiles();
                    this.pieces = [];
                }
                
                createTiles() {
                    if (this.y < this.board.h / 2) {
                        for (let y = this.y; y < this.y + this.h; y += pieceSize) {
                            this.tiles.push(new Tile(this, this.x, y));
                        }
                    } else if (this.y > this.board.h / 2) {
                        for (let y = this.y + this.h - pieceSize; y >= this.y; y -= pieceSize) {
                            this.tiles.push(new Tile(this, this.x, y));
                        }
                    }
                }

                addPiece(player) {
                    this.pieces.push(new Piece(this.board, this, player, this.tiles[this.pieces.length]));
                }

                draw(context) {
                    for (let i = 0; i < this.pieces.length; ++i) {
                        this.pieces[i].draw(context);
                    }
                }
            }

            class Tile {
                constructor(position, x, y) {
                    this.position = position;
                    this.x = x;
                    this.y = y;
                }
            }

            class Piece {
                constructor(board, position, owner, tile) {
                    this.board = board;
                    this.position = this.board.positions.indexOf(position);
                    this.owner = owner;
                    this.image = this.owner === "player1" ? whitePiece : blackPiece;
                    this.x = tile.x;
                    this.y = tile.y;
                }

                draw(context) {
                    context.drawImage(this.image, this.x, this.y, pieceSize, pieceSize);
                }
            }

            const board = new Board();
            board.setBoard();
            board.draw(ctx);
        });
    </script>
</body>

</html>